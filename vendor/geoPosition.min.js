/*
* javascript-mobile-desktop-geolocation
* https://github.com/estebanav/javascript-mobile-desktop-geolocation
*
* Copyright J. Esteban Acosta VillafaÃ±e
* Licensed under the MIT licenses.
*
* Based on Stan Wiechers > geo-location-javascript v0.4.8 > http://code.google.com/p/geo-location-javascript/

* Revision: $Rev: 01 $: 
* Author: $Author: estebanav $:
* Date: $Date: 2012-09-07 23:03:53 -0300 (Fri, 07 Sep 2012) $:   
*/
var bb={success:0,error:0,blackberryTimeoutId:-1};function handleBlackBerryLocationTimeout(){if(bb.blackberryTimeoutId!=-1){bb.error({message:"Timeout error",code:3})}}function handleBlackBerryLocation(){clearTimeout(bb.blackberryTimeoutId);bb.blackberryTimeoutId=-1;if(bb.success&&bb.error){if(blackberry.location.latitude==0&&blackberry.location.longitude==0){bb.error({message:"Position unavailable",code:2})}else{var a=null;if(blackberry.location.timestamp){a=new Date(blackberry.location.timestamp)}bb.success({timestamp:a,coords:{latitude:blackberry.location.latitude,longitude:blackberry.location.longitude}})}bb.success=null;bb.error=null}}var geoPosition=function(){var c={};var b=null;var d="undefined";var a="http://freegeoip.net/json/?callback=JSONPCallback";c.getCurrentPosition=function(g,e,f){b.getCurrentPosition(g,e,f)};c.jsonp={callbackCounter:0,fetch:function(h,e){var f="JSONPCallback_"+this.callbackCounter++;window[f]=this.evalJSONP(e);h=h.replace("=JSONPCallback","="+f);var g=document.createElement("SCRIPT");g.src=h;document.getElementsByTagName("HEAD")[0].appendChild(g)},evalJSONP:function(e){return function(f){e(f)}}};c.confirmation=function(){return confirm("This Webpage wants to track your physical location.\nDo you allow it?")};c.init=function(){try{var g=typeof(navigator.geolocation)!=d;if(!g){if(!c.confirmation()){return false}}if((typeof(geoPositionSimulator)!=d)&&(geoPositionSimulator.length>0)){b=geoPositionSimulator}else{if(typeof(bondi)!=d&&typeof(bondi.geolocation)!=d){b=bondi.geolocation}else{if(g){b=navigator.geolocation;c.getCurrentPosition=function(j,h,i){function e(k){var l;if(typeof(k.latitude)!=d){l={timestamp:k.timestamp,coords:{latitude:k.latitude,longitude:k.longitude}}}else{l=k}j(l)}b.getCurrentPosition(e,h,i)}}else{if(typeof(window.blackberry)!=d&&blackberry.location.GPSSupported){if(typeof(blackberry.location.setAidMode)==d){return false}blackberry.location.setAidMode(2);c.getCurrentPosition=function(i,e,h){bb.success=i;bb.error=e;if(h.timeout){bb.blackberryTimeoutId=setTimeout("handleBlackBerryLocationTimeout()",h.timeout)}else{bb.blackberryTimeoutId=setTimeout("handleBlackBerryLocationTimeout()",60000)}blackberry.location.onLocationUpdate("handleBlackBerryLocation()");blackberry.location.refreshLocation()};b=blackberry.location}else{if(typeof(Mojo)!=d&&typeof(Mojo.Service.Request)!="Mojo.Service.Request"){b=true;c.getCurrentPosition=function(i,e,h){parameters={};if(h){if(h.enableHighAccuracy&&h.enableHighAccuracy==true){parameters.accuracy=1}if(h.maximumAge){parameters.maximumAge=h.maximumAge}if(h.responseTime){if(h.responseTime<5){parameters.responseTime=1}else{if(h.responseTime<20){parameters.responseTime=2}else{parameters.timeout=3}}}}r=new Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:parameters,onSuccess:function(j){i({timestamp:j.timestamp,coords:{latitude:j.latitude,longitude:j.longitude,heading:j.heading}})},onFailure:function(j){if(j.errorCode==1){e({code:3,message:"Timeout"})}else{if(j.errorCode==2){e({code:2,message:"Position unavailable"})}else{e({code:0,message:"Unknown Error: webOS-code"+errorCode})}}}})}}else{if(typeof(device)!=d&&typeof(device.getServiceObject)!=d){b=device.getServiceObject("Service.Location","ILocation");c.getCurrentPosition=function(k,i,j){function e(n,l,m){if(l==4){i({message:"Position unavailable",code:2})}else{k({timestamp:null,coords:{latitude:m.ReturnValue.Latitude,longitude:m.ReturnValue.Longitude,altitude:m.ReturnValue.Altitude,heading:m.ReturnValue.Heading}})}}var h=new Object();h.LocationInformationClass="BasicLocationInformation";b.ILocation.GetLocation(h,e)}}else{c.getCurrentPosition=function(i,e,h){c.jsonp.fetch(a,function(j){i({timestamp:j.timestamp,coords:{latitude:j.latitude,longitude:j.longitude,heading:j.heading}})})};b=true}}}}}}}catch(f){if(typeof(console)!=d){console.log(f)}return false}return b!=null};return c}();